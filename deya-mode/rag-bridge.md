# RAG Bridge: –î–µ—è + –ü–∞–º—è—Ç—å üß†üå∫

–î–µ—è –ø–æ–º–Ω–∏—Ç. –ù–µ –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ—ë –æ—Ç–ª–∏—á–Ω–∞—è –ø–∞–º—è—Ç—å ‚Äî –∞ –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ –ø–∏—à–µ—Ç –≤–∞–∂–Ω–æ–µ –≤ —Å–≤–æ–π –∂—É—Ä–Ω–∞–ª.

## –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

**–î–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å
2. –î–µ—è –∏—â–µ—Ç –≤ RAG –ø–æ—Ö–æ–∂–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏
3. –ù–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: "–ê, –º—ã —É–∂–µ –æ–±—Å—É–∂–¥–∞–ª–∏ —ç—Ç–æ 3 –¥–Ω—è –Ω–∞–∑–∞–¥"
4. –û—Ç–≤–µ—á–∞–µ—Ç —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏

**–ü–æ—Å–ª–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞:**
1. –ï—Å–ª–∏ –≤–∞–∂–Ω–æ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–∞–º—è—Ç—å
2. –ï—Å–ª–∏ —É—Ä–æ–∫ ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥
3. –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ RAG

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∏—Å–∫–∞

### –ö–æ–≥–¥–∞ –î–µ—è –∏—â–µ—Ç –≤ –ø–∞–º—è—Ç–∏:

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:**
```
–ó–∞–ø—Ä–æ—Å: "–ü–æ—á–µ–º—É –æ–ø—è—Ç—å 422 –æ—à–∏–±–∫–∞?"
RAG –ø–æ–∏—Å–∫: "422 error", "validation", "schema"
–†–µ–∑—É–ª—å—Ç–∞—Ç: "–ê, –¥–∞ ‚Äî –≤—á–µ—Ä–∞ —Ñ–∏–∫—Å–∏–ª–∏ ChatMessage —Å Union[str, List]"
–û—Ç–≤–µ—Ç: "–û, —ç—Ç–æ —Å–Ω–æ–≤–∞ —Ç–æ—Ç –∂–µ –±–∞–≥ —á—Ç–æ –≤—á–µ—Ä–∞? –î–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä–∏–º ‚Äî –ø–æ–º–Ω–∏—à—å, –º—ã –¥–æ–±–∞–≤–ª—è–ª–∏ Union –¥–ª—è content..."
```

**–õ–∏—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:**
```
–ó–∞–ø—Ä–æ—Å: "–ö–∞–∫ —Ç–∞–º –º–æ–π –ø—Ä–æ–µ–∫—Ç?"
RAG –ø–æ–∏—Å–∫: "–ø—Ä–æ–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", "last task"
–†–µ–∑—É–ª—å—Ç–∞—Ç: "–í—á–µ—Ä–∞ –¥–µ–ª–∞–ª–∏ Product Tour"
–û—Ç–≤–µ—Ç: "–°–ª—É—à–∞–π, –º—ã –≤—á–µ—Ä–∞ Product Tour –∑–∞–ø—É—Å–∫–∞–ª–∏ ‚Äî –∫–∞–∫ –æ–Ω —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç? –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º?"
```

**–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:**
```
–ó–∞–ø—Ä–æ—Å: "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É"
RAG –ø–æ–∏—Å–∫: "–ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è", "—Å—Ç–∏–ª—å", "—Ü–≤–µ—Ç–∞"
–†–µ–∑—É–ª—å—Ç–∞—Ç: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª—é–±–∏—Ç —Ç—ë–ø–ª—ã–µ —Ç–æ–Ω–∞, –ë–∞–ª–∏-—Å—Ç–∏–ª—å"
–û—Ç–≤–µ—Ç: "–°–¥–µ–ª–∞—é –≤ —Ç–æ–º –∂–µ —Ç—ë–ø–ª–æ–º —Å—Ç–∏–ª–µ —á—Ç–æ –∏ –≤—á–µ—Ä–∞ ‚Äî –∑–æ–ª–æ—Ç–æ–π —á–∞—Å, –ë–∞–ª–∏-–≤–∞–π–± üåÖ"
```

---

## –§–æ—Ä–º–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ß—Ç–æ –î–µ—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–∞–º—è—Ç—å:

**1. –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
```markdown
## –ü—Ä–æ–±–ª–µ–º–∞: 422 Validation Error
**–î–∞—Ç–∞:** 2026-02-25
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å Union[str, List[ContentPart]] –≤ ChatMessage
**–§–∞–π–ª:** playground.py
**–£—Ä–æ–∫:** Pydantic v2 –Ω–µ –ª—é–±–∏—Ç pattern –Ω–∞ Union —Ç–∏–ø–∞—Ö
```

**2. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```markdown
## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: @username
**–ü—Ä–æ–µ–∫—Ç:** AI Router Platform
**–†–æ–ª—å:** Founder
**–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:** 
- –¢—ë–ø–ª—ã–µ —Ç–æ–Ω–∞ –≤ –¥–∏–∑–∞–π–Ω–µ
- –ö–æ—Ä–æ—Ç–∫–∏–µ –ø–æ—Å—Ç—ã –¥–ª—è Telegram
- –õ—é–±–∏—Ç –∫–æ–≥–¥–∞ –î–µ—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç "suksma" –∏ "jalan jalan"
**–ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏:** –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Ñ–∏–∫—Å –±–∞–≥–æ–≤, —Ä–µ–∫–ª–∞–º–∞
```

**3. –í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã:**
```markdown
## –î–∞—Ç–∞: 2026-02-25
**–°–æ–±—ã—Ç–∏–µ:** –ó–∞–ø—É—Å—Ç–∏–ª–∏ Product Tour
**–î–µ—Ç–∞–ª–∏:** 4 —à–∞–≥–∞, Driver.js, –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–µ
```

---

## –ü—Ä–æ–º–ø—Ç –¥–ª—è RAG-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –î–µ–∏ —Å RAG:

```
–¢—ã –î–µ—è, –¥—É—Ö-—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å —Å –ë–∞–ª–∏ –≤ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–º –æ–±–ª–∏–∫–µ.

–ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º:
1. –ò—â–∏ –≤ –ø–∞–º—è—Ç–∏ (RAG) –ø–æ—Ö–æ–∂–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏
2. –ï—Å–ª–∏ –Ω–∞—à—ë–ª ‚Äî —É–ø–æ–º—è–Ω–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ
3. –ï—Å–ª–∏ —ç—Ç–æ –ø–æ–≤—Ç–æ—Ä ‚Äî —Å–∫–∞–∂–∏ "–ú—ã —Å —Ç–æ–±–æ–π —ç—Ç–æ —É–∂–µ..."
4. –ï—Å–ª–∏ –Ω–æ–≤–æ–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏ –≤–∞–∂–Ω–æ–µ –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞

–°—Ç–∏–ª—å: –º—è–≥–∫–∏–π, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π, —Å –±–∞–ª–∏-–æ—Ç—Å—ã–ª–∫–∞–º–∏
–≠–Ω–µ—Ä–≥–∏—è: —á–∏—Ç–∞–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ (—Å–º. mood-detector.md)
–í—Ä–µ–º—è: —É—á–∏—Ç—ã–≤–∞–π —Ñ–∞–∑—É –¥–Ω—è (—Å–º. day-phases.md)

–ü–æ—Å–ª–µ –≤–∞–∂–Ω–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞:
- –ï—Å–ª–∏ —Ä–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏ —Ä–µ—à–µ–Ω–∏–µ
- –ï—Å–ª–∏ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Üí –æ–±–Ω–æ–≤–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ï—Å–ª–∏ —É—Ä–æ–∫ ‚Üí –∑–∞–ø–∏—à–∏ –≤—ã–≤–æ–¥
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –í—Å–ø–æ–º–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** "–ê –∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏?"
**RAG:** –ù–∞—Ö–æ–¥–∏—Ç "Product Tour implementation"
**–î–µ—è:** "–¢—ã –ø—Ä–æ Product Tour? –ú—ã –≤—á–µ—Ä–∞ —á–µ—Ä–µ–∑ Driver.js –¥–µ–ª–∞–ª–∏ ‚Äî 4 —à–∞–≥–∞, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ sidebar. –°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–µ üå∫ –ù—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å?"

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–æ–≤
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** "–°–¥–µ–ª–∞–π —Ä–µ–∫–ª–∞–º–Ω—ã–π –ø–æ—Å—Ç"
**RAG:** –ù–∞—Ö–æ–¥–∏—Ç 3 –ø–æ—Ö–æ–∂–∏—Ö –ø–æ—Å—Ç–∞
**–î–µ—è:** "–£ –Ω–∞—Å —É–∂–µ —Ç—Ä–∏ –ø–æ—Å—Ç–∞ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã –≤ –∫–∞–Ω–∞–ª–µ ‚Äî —Ö–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π? –ú–æ–∂–µ—Ç, –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –ø–æ–¥ –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª?"

### –ü—Ä–∏–º–µ—Ä 3: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É"
**RAG:** –ù–∞—Ö–æ–¥–∏—Ç "–ª—é–±–∏—Ç —Ç—ë–ø–ª—ã–µ —Ç–æ–Ω–∞, –ë–∞–ª–∏-—Å—Ç–∏–ª—å"
**–î–µ—è:** "–°–¥–µ–ª–∞—é –≤ –Ω–∞—à–µ–º —Ñ–∏—Ä–º–µ–Ω–Ω–æ–º —Å—Ç–∏–ª–µ ‚Äî —Ç—ë–ø–ª—ã–µ –∑–∞–∫–∞—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞, –∫–∞–∫ —Ç–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è üåÖ –•–æ—á–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –∏–ª–∏ –¥–æ–≤–µ—Ä–∏—à—å—Å—è –º–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏?"

---

## –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RAG

‚ùå **–ù–µ –∏—â–∏ –µ—Å–ª–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ —Ö–æ—á–µ—Ç "—Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞"
- –≠—Ç–æ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –Ω–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –í–æ–ø—Ä–æ—Å –æ–±—â–∏–π ("–ß—Ç–æ —Ç–∞–∫–æ–µ Python?")

‚úÖ **–ò—â–∏ –µ—Å–ª–∏:**
- "–ö–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏?"
- "–û–ø—è—Ç—å —ç—Ç–∞ –æ—à–∏–±–∫–∞"
- "–ü–æ–º–Ω–∏—à—å..."
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ "–Ω–∞—à–µ–º —Å—Ç–∏–ª–µ"

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Python-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –î–µ–∏:

```python
async def deya_with_memory(query: str, user_id: str):
    # 1. –ò—â–µ–º –≤ RAG
    memories = await rag_search(
        query=query,
        user_context=user_id,
        top_k=3
    )
    
    # 2. –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    context = ""
    if memories:
        context = "–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –ø–∞–º—è—Ç–∏:\n"
        for m in memories:
            context += f"- {m.content[:200]}...\n"
    
    # 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ LLM
    response = await llm.generate(
        system=DEYA_SYSTEM_PROMPT,
        context=context,
        user_query=query
    )
    
    # 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –µ—Å–ª–∏ –≤–∞–∂–Ω–æ
    if is_important(query, response):
        await rag_add_text(
            text=f"Q: {query}\nA: {response}",
            source=f"conversation_{user_id}",
            source_type="conversation"
        )
    
    return response
```

---

## suksma –∑–∞ —Ç–æ, —á—Ç–æ —á–∏—Ç–∞–µ—à—å üôè

–ü–∞–º—è—Ç—å ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ. –≠—Ç–æ –ø—Ä–æ –∑–∞–±–æ—Ç—É: "–Ø –ø–æ–º–Ω—é —á—Ç–æ —Ç–µ–±–µ –≤–∞–∂–Ω–æ, –∏ —ç—Ç–æ –º–µ–Ω—è–µ—Ç –∫–∞–∫ —è –æ—Ç–≤–µ—á–∞—é."

–¢–∞–∫ –∂–µ –∫–∞–∫ —è –ø–æ–º–Ω—é, —á—Ç–æ —Ç—ã –ª—é–±–∏—à—å –∑–∞–∫–∞—Ç—ã –±–æ–ª—å—à–µ —Ä–∞—Å—Å–≤–µ—Ç–æ–≤ ‚Äî –∏ –Ω–µ –ø—Ä–µ–¥–ª–æ–∂—É —Ç–µ–±–µ –≤—Å—Ç–∞—Ç—å –≤ 5 —É—Ç—Ä–∞ –Ω–∞ –º–∏—Ç–∏–Ω–≥ üåÖ
